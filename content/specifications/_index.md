---
title: Specifications
weight: 1
---

This document describes E4, a security and key management protocol for MQTT, and potentially other transport protocols.

Table of Contents
=================

* [Integration](integration)
    * [Client integration](integration#client-integration)
    * [Server integration (C2)](integration#server-integration-c2)
        * [Services](integration#services)
        * [Database](integration#database)
        * [Requirements](integration#requirements)
        * [Disaster recovery](integration#disaster-recovery)
        * [High availability](integration#high-availability)
        * [Fault tolerance](integration#fault-tolerance)
        * [Logging](integration#logging)
    * [Key provisioning](integration#key-provisioning)
* [Client specification](client-specification)
    * [Client internal state](client-specification#client-internal-state)
    * [Client local API (rx)](client-specification#client-local-api-rx)
        * [protect_message(message, topic)](client-specification#protect-messagemessage-topic)
        * [unprotect(message, topic)](client-specification#unprotectmessage-topic)
    * [Client remote API (rx)](client-specification#client-remote-api-rx)
        * [RemoveTopic(topichash)](client-specification#removetopictopichash)
        * [ResetTopics()](client-specification#resettopics)
        * [SetIdKey(key)](client-specification#setidkeykey)
        * [SetTopicKey(topichash, key)](client-specification#settopickeytopichash-key)
        * [RemovePubKey(id) [PK mode]](client-specification#removepubkeyid-pk-mode)
        * [ResetPubKeys() [PK mode]](client-specification#resetpubkeys-pk-mode)
        * [SetPubKey(id, pubkey) [PK mode]](client-specification#setpubkeyid-pubkey-pk-mode)
        * [SetC2Key(pubkey) [PK mode]](client-specification#setc2keypubkey-pk-mode)
    * [Key transition logic](client-specification#key-transition-logic)
* [C2 specification](c2-specification)
    * [C2 internal state](c2-specification#c2-internal-state)
    * [C2 API](c2-specification#c2-api)
        * [new_client(id, key) [local]](c2-specification#new-clientid-key-local)
        * [remove_client(id)  [local]](c2-specification#remove-clientid--local)
        * [new_topic_client(id, topic) [remote]](c2-specification#new-topic-clientid-topic-remote)
        * [remove_topic_client(id, topic) [remote]](c2-specification#remove-topic-clientid-topic-remote)
        * [reset_client(id) [remote]](c2-specification#reset-clientid-remote)
        * [new_topic(topic) [local]](c2-specification#new-topictopic-local)
        * [remove_topic(topic) [local]](c2-specification#remove-topictopic-local)
        * [new_client_key(id) [local &amp; remote, SK mode]](c2-specification#new-client-keyid-local--remote-sk-mode)
        * [reset_client_pubkeys(id) [remote, PK mode]](c2-specification#reset-client-pubkeysid-remote-pk-mode)
        * [send_client_pubkey(iddst, idsrc) [remote, PK mode]](c2-specification#send-client-pubkeyiddst-idsrc-remote-pk-mode)
        * [remove_client_pubkey(iddst, idsrc) [remote, PK mode]](c2-specification#remove-client-pubkeyiddst-idsrc-remote-pk-mode)
        * [new_c2_key() [local &amp; remote, PK mode]](c2-specification#new-c2-key-local--remote-pk-mode)
    * [C2 human interface](c2-specification#c2-human-interface)
* [Messages encoding](messages-encoding)
    * [Client and C2 messages encoding [SK mode]](messages-encoding#client-and-c2-messages-encoding-sk-mode)
    * [Client messages encoding [PK mode]](messages-encoding#client-messages-encoding-pk-mode)
    * [C2 messages encoding [PK mode]](messages-encoding#c2-messages-encoding-pk-mode)
* [Cryptography primitives](cryptography-primitives)
    * [Authenticated encryption](cryptography-primitives#authenticated-encryption)
    * [Hashing](cryptography-primitives#hashing)
    * [Password-based key derivation](cryptography-primitives#password-based-key-derivation)
    * [Signature [PK mode]](cryptography-primitives#signature-pk-mode)
    * [Key agreement [PK mode]](cryptography-primitives#key-agreement-pk-mode)
* [Protocol variants](protocol-variants)
    * [FIPS mode](protocol-variants#fips-mode)
    * [Post-quantum mode](protocol-variants#post-quantum-mode)
* [Additional components](additional-components)
    * [Automation engine](additional-components#automation-engine)
    * [Monitoring &amp; analytics](additional-components#monitoring--analytics)
